<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="css/css.css">
    <script src="jquery-3.2.1.min.js"></script>
    <script src="js/map.js"></script>
    <script src="js/aikatauluhsl.js"></script>
    <script src="js/info.js"></script>
    <script src="js/time.js"></script>
	<script type="text/javascript" src="js/jquery.leanModal.min.js"></script>
</head>

<body onload="startTime()">
<div id="parentdiv">
    <center><div id="time"></div></center>
	<div class="notices"><marquee behavior="scroll" direction="left"><p id="incl"></p></marquee></div>
    <div class="map" id="map">
        <!-- Google maps tulee tähän -->
    </div>
	
    <div id="chili">
        <div id="AikaTaulu">
		<center><h4 style="margin-bottom:0;">Älybussi</h4><i class="fa fa-bus" aria-hidden="true"></i></center>
        <blink><center><p id="aikataulu"></p></center><blink>
        <script>
            var times = new Array();
            times[0] = "~5 Min";

            $(function(){
                var list = "";
                for(i=0; i<times.length; i++){
                    list +="<p>"+times[i]+"</p>";
                }
                $("#aikataulu").append(list);
            });
        </script>
        </div>
		<div id="HSLroutes">
			<center><h4 style="margin-bottom:0;">HSL</h4></center>
                <table id="table" class="table table-condensed" cellspacing="10">
                <tr>
                    <th>Time</th>
                    <th>Buss</th>
                    <th>Destination</th>
                </tr>
            </table>
			<div class="hsl123"><ul id="hsl_aikataulu"></ul></div>

            <div class="hsl123"><ul id="hsl_bussit"></ul></div>

            <div class="hsl123"><ul id="hsl_kohde"</ul></div>

			<script>

                fetch('https://api.digitransit.fi/routing/v1/routers/hsl/index/graphql', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ query: '{ stop(id:"HSL:2222204") { name, lat, lon  stoptimesWithoutPatterns(numberOfDepartures:5) {scheduledDeparture, trip{tripHeadsign, route{shortName}   }}}} '}),
                })
                    .then(res => res.json())
                .then(res => {
                    console.log(res);


                for(i=0; i<res.data.stop.stoptimesWithoutPatterns.length; i++) {

                    // console.log(res.data.stop.stoptimesWithoutPatterns[i].scheduledDeparture);
                    var name = res.data.stop.name;
                    //var divisor = 0.000277777778;
                    var data = res.data.stop.stoptimesWithoutPatterns[i].scheduledDeparture;
                    //var divided = (data*divisor) %24;
                    //var display = divided.toFixed(2);
                    var buss = res.data.stop.stoptimesWithoutPatterns[i].trip.route.shortName;
                    var destination = res.data.stop.stoptimesWithoutPatterns[i].trip.tripHeadsign;

                    var date = new Date(null);
                    date.setSeconds(data); // specify value for SECONDS here
                    var result = date.toISOString().substr(11, 8);
                    var slice = result.slice(0 , -3);

                    // jos document.getElementById, niin koodi on javascriptiä
                    // jos taas $('#hsl_bussit'). niin koodi on Jqueryä
                    $('#hsl_bussit').append('<li>' + buss +'</li>');
                    //document.getElementById("hsl_bussit").append('<li>' + buss +'</li>');
                    $('#hsl_kohde').append('<li>' + destination +'</li>');
                    $('#hsl_aikataulu').append('<li>' +slice + '</li>');

                }
                });

			</script>
		</div>
        <div id="mainos">
            <center><img id="mainosLogo" width="275em" src="img/MetropoliaLogo.png"></center>
             <!-- Mahdolliset mainokset -->
        </div>

    </div>

</div>

<div id="buttonZoom">
    <button id="resize"> <i class="fa fa-plus-circle" aria-hidden="true"></i> </button><br>
    <a id="go" href="#infoText"><button id="info"><i class="fa fa-info-circle" aria-hidden="true"></i>
    </button></a>
</div>

<div class="infoT" id="infoText">
    <h1>Älybussipysäkki</h1>
	<p>Sohjoa projekti</p>
    <p id="infocontnet"></p>
    <p id="infoeng" ></p>
</div>

<script>
	//GPS tracking server ip example: 'http://11.111.111.111:8082/api';
	var root = 'http://localhost:8082/api';
	
	/*var marker = new google.maps.Marker({
		position: data2[0].latitude + data2[0].longitude, 
		map: map,
		title: 'Hello World!'
	});*/
	
	$("#go").leanModal(); //launches info modal on click 
    
	function muutakoko(){ //change map size to larger and hide other elements on page
            var kartta = document.getElementById("map");
            var chili = document.getElementById("chili")
            var value = $(this).html();
            if(value != '<i class="fa fa-minus-circle" aria-hidden="true"></i>'){
                $(this).html('<i class="fa fa-minus-circle" aria-hidden="true"></i>');
                $(kartta).toggleClass('fullscreen map');
                $(chili).addClass('katoa');
                initMap();
                return false;
            }else{
                $(this).html('<i class="fa fa-plus-circle" aria-hidden="true"></i>');
                $(kartta).toggleClass('map fullscreen');
                $(chili).removeClass('katoa');
                initMap();
            }
    }
	
	$('#resize').click(muutakoko);
	
	//Keyboard variables
	var pressed = 0;
	var infoVisible = 0;
	//Keyboard functions
	document.addEventListener('keydown', function(event) {
    if(event.keyCode == 37 && pressed == 0) {
		$('#resize').each(muutakoko);	
		pressed = 1;
		setTimeout(clearPress, 2000);
    } else if (event.keyCode == 39 && pressed == 0) {
		pressed = 1;
		if (infoVisible == 0){
			$("#go").click();
			infoVisible = 1;
		} else {
			$("#lean_overlay").trigger("click");
			infoVisible = 0;
		}
		setTimeout(clearPress, 2000);
	}
	//Keyboard functions
	function clearPress(){
		pressed = 0;
	}

});

</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBTdnp378Eb1qxZRQrYJcT7jIoyJlLxZvE&callback=initMap"></script>
<script src="js/notices.js"></script>
<script src="js/info2.js"></script>
<script src="https://use.fontawesome.com/fa1c56c54e.js"></script>
</body>
</html>